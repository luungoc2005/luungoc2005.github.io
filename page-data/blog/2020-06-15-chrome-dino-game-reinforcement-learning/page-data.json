{"componentChunkName":"component---src-components-blog-post-blog-post-tsx","path":"/blog/2020-06-15-chrome-dino-game-reinforcement-learning/","result":{"data":{"markdownRemark":{"html":"<h1>Introduction</h1>\n<hr>\n<div class=\"custom-block snippet\"><div class=\"custom-block-body\"><p>In this tutorial I will briefly walk through how you can create an OpenAI Gym environment for the Google Chrome Dino game, and use Stable Baselines to quickly train an agent for it. Bonus: The environment can be easily extended to other browser games as well!.</p></div></div>\n<p>This tutorial assumes you are at least familiar with Python in general. It will not go deep into model development or length explanations - that I'll save for another time. If you are new to machine learning, this will hopefully pique your interest ðŸ˜‹.</p>\n<h1>Preparation</h1>\n<hr>\n<p>Ideally, you already have installed a environment manager for Python, such as <code class=\"language-text\">pipenv</code> or <code class=\"language-text\">Anaconda</code>/<code class=\"language-text\">Miniconda</code>. Create a new environment in Python 3.6 (with Python 3.7 you may have trouble installing Tensorflow because we will be using an older version).</p>\n<p>We will be needing the following dependencies:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gym\nselenium\nopencv\nPillow\nstable-baselines</code></pre></div>\n<p>Since this project will be to play the Dino game, we will also need Google Chrome and Chrome driver for selenium, which can be downloaded here: <a href=\"https://chromedriver.chromium.org/downloads\">https://chromedriver.chromium.org/downloads</a> . Select the latest version and download the binary for your OS, and extract it into your project's working folder.</p>\n<h1>Selenium and the Chrome Dino game</h1>\n<hr>\n<p>For this part we will need some frontend knowledge and dig around with the Chrome inspector and console. The Chrome Dino game itself is comparably very convenient, but it might not be so for other games.</p>\n<p>First we define the webdriver object with:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> os\n<span class=\"token keyword\">from</span> selenium <span class=\"token keyword\">import</span> webdriver\n\n_chrome_options <span class=\"token operator\">=</span> webdriver<span class=\"token punctuation\">.</span>ChromeOptions<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n_chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"--mute-audio\"</span><span class=\"token punctuation\">)</span>\n\n_driver <span class=\"token operator\">=</span> webdriver<span class=\"token punctuation\">.</span>Chrome<span class=\"token punctuation\">(</span>\n    executable_path<span class=\"token operator\">=</span>os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>\n        os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>dirname<span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>abspath<span class=\"token punctuation\">(</span>__file__<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"chromedriver\"</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    chrome_options<span class=\"token operator\">=</span>_chrome_options\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>After which we can launch the game by going to <code class=\"language-text\">chrome://dino</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>keys <span class=\"token keyword\">import</span> Keys\n\n_driver<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'chrome://dino'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># trigger game start by pressing spacebar</span>\n_driver \\\n    <span class=\"token punctuation\">.</span>find_element_by_tag_name<span class=\"token punctuation\">(</span><span class=\"token string\">\"body\"</span><span class=\"token punctuation\">)</span> \\\n    <span class=\"token punctuation\">.</span>send_keys<span class=\"token punctuation\">(</span>Keys<span class=\"token punctuation\">.</span>SPACE<span class=\"token punctuation\">)</span></code></pre></div>\n<p>The game screen itself is rendered to a <code class=\"language-text\">canvas</code> with <code class=\"language-text\">class=&quot;runner-canvas&quot;</code>, therefore we can easily get the entire game screen with <code class=\"language-text\">.toDataURL()</code></p>\n<p>The game also exposes a <code class=\"language-text\">Runner</code> object to global space (convenient! in the world of minifiers...), where we can get whether the game is still running with <code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>Runner<span class=\"token punctuation\">.</span>instance_<span class=\"token punctuation\">.</span>playing<span class=\"token punctuation\">)</span></code>. The score can be read from <code class=\"language-js\">console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>Runner<span class=\"token punctuation\">.</span>instance_<span class=\"token punctuation\">.</span>distanceMeter<span class=\"token punctuation\">.</span>digits<span class=\"token punctuation\">)</span></code> as an array of digits, though that is not entirely necessary in this case.</p>\n<p>Similarly, controls to the game can be sent with <code class=\"language-text\">send_keys</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>keys <span class=\"token keyword\">import</span> Keys\n\n_driver<span class=\"token punctuation\">.</span>find_element_by_tag_name<span class=\"token punctuation\">(</span><span class=\"token string\">\"body\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>send_keys<span class=\"token punctuation\">(</span>Keys<span class=\"token punctuation\">.</span>SPACE<span class=\"token punctuation\">)</span></code></pre></div>\n<p>For other games, however, <code class=\"language-text\">send_keys</code> only simulates a key press event. Sometimes the game would require the keys to be <em>held down</em> instead, which will require sending the key down and key up events individually. In other cases, some actions in the game might require a certain <em>sequence</em> of key presses and the odds might be too low for the AI to be able to figure out. In those cases, we can use Selenium's <code class=\"language-text\">ActionChains</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>keys <span class=\"token keyword\">import</span> Keys\n<span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>action_chains <span class=\"token keyword\">import</span> ActionChains\n\naction_chains <span class=\"token operator\">=</span> ActionChains<span class=\"token punctuation\">(</span>_driver<span class=\"token punctuation\">)</span>\naction_chains<span class=\"token punctuation\">.</span>key_down<span class=\"token punctuation\">(</span>Keys<span class=\"token punctuation\">.</span>ARROW_UP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>perform<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\naction_chains<span class=\"token punctuation\">.</span>key_up<span class=\"token punctuation\">(</span>Keys<span class=\"token punctuation\">.</span>ARROW_UP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>perform<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h1>Creating a custom OpenAI Gym environment</h1>\n<hr>\n<p>An <em>environment</em> is how you can define the target that a reinforcement learning algorithm would run on. The idea is the algorithm, or <em>agent</em>, have to be able to observe the current environment's state, make actions, and know what kind of rewards that each action would bring. In the context of a simple game, the actions would be key presses, and the state can be pixels on the screen.</p>\n<p>A minimal Gym environment would look like this</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> gym\n<span class=\"token keyword\">from</span> gym <span class=\"token keyword\">import</span> spaces\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomEnv</span><span class=\"token punctuation\">(</span>gym<span class=\"token punctuation\">.</span>Env<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">__init__</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># action_space and observation_space can be anything from spaces</span>\n        self<span class=\"token punctuation\">.</span>action_space <span class=\"token operator\">=</span> spaces<span class=\"token punctuation\">.</span>Discrete<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        self<span class=\"token punctuation\">.</span>observation_space <span class=\"token operator\">=</span> spaces<span class=\"token punctuation\">.</span>Box<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">step</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> action<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">pass</span>\n        <span class=\"token comment\"># return observation, reward, done, extra_info</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">,</span> mode<span class=\"token operator\">=</span><span class=\"token string\">'human'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">pass</span>\n        <span class=\"token comment\"># return image array</span>\n\n    <span class=\"token keyword\">def</span> <span class=\"token function\">reset</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">pass</span>\n\n    <span class=\"token comment\"># not required</span>\n    <span class=\"token keyword\">def</span> <span class=\"token function\">close</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">pass</span></code></pre></div>\n<p>In <code class=\"language-text\">__init__</code> you would define the <code class=\"language-text\">action_space</code> and <code class=\"language-text\">observation_space</code>. <code class=\"language-text\">action_space</code> in this case is straightforward: The Dino can either do nothing, jump up (spacebar or up arrow key) or duck (down arrow key), so we can use <code class=\"language-python\">spaces<span class=\"token punctuation\">.</span>Discrete<span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span></code> to model this. For other games that might require more keys to control, you can adjust accordingly.</p>\n<p><em>Side note:</em> In this case, initially, I thought the dino would only need jump and duck actions - and having a smaller action space would help the model learn faster. That did not end up being the case, since the duck action <em>can</em> cancel out the jump action, therefore leaving only the 2 will make it hard for the agent to even jump past 1 obstacle.</p>\n<h2>The step function</h2>\n<p><code class=\"language-text\">step</code> is arguably the most important function to define for a Gym environment. This is where you would define how an action can affect the environment, and how to observe the current state of the environment. As can be seen from the skeleton code above, it is supposed to return 4 values as follows:</p>\n<ul>\n<li><code class=\"language-text\">observation</code>: We need to convert the state of the environment into a fixed array format to feed into the model. In this case we can use the screenshot of the game directly, but a lot of other games might require additional information.</li>\n</ul>\n<p>The interesting part of this is thanks to the power of <em>deep learning</em>, the agent can use the pixels on the screen as its input. This means we don't have to use any custom, hand-crafted object detection techniques for detecting obstacles. However, normally, neural network for <em>vision</em> often resize images down to a very small size for performance. To put things into perspective, the state-of-the-art models usually use image sizes of up to 512x512px. This means you cannot just use 4K game screenshots as no conventional neural networks will be able to handle it. If need be, workarounds include splitting the image into parts, or isolate regions of interest.</p>\n<p>As demonstration, for this game I cropped out only the part of the screen in front of the <em>Dino</em> and resize the image down to 96x96px. It's worth noting, however, that the original Deep-Q-Learning on Atari games paper do just take the entire screen - including the scores and such. So that actually would still work for this game, it will just not be as efficient.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 120px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/85c6c7aecff09bb8d08fb15e8a8b0f42/e439a/chrome-dino-game-reinforcement-learning-observation.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIDBv/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAefa5FJG0AB//8QAGhAAAgMBAQAAAAAAAAAAAAAAAAECEBIRE//aAAgBAQABBQKuMUG416Szo0f/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AR//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAdEAAABQUAAAAAAAAAAAAAAAAAARBBkQIREiEx/9oACAEBAAY/AlOpiXHVg0DhQP/EABsQAAIDAAMAAAAAAAAAAAAAAAARARBRQWFx/9oACAEBAAE/Ia6pHmWnN+0NIbAgL//aAAwDAQACAAMAAAAQAMA8/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHRABAAICAgMAAAAAAAAAAAAAAQARECFhgTFx8f/aAAgBAQABPxDA5puojQURDutUc4t5nkbatND6nw0Wtt0n/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"This is what the agent actually sees\"\n        title=\"This is what the agent actually sees\"\n        src=\"/static/85c6c7aecff09bb8d08fb15e8a8b0f42/e439a/chrome-dino-game-reinforcement-learning-observation.jpg\"\n        srcset=\"/static/85c6c7aecff09bb8d08fb15e8a8b0f42/e439a/chrome-dino-game-reinforcement-learning-observation.jpg 120w\"\n        sizes=\"(max-width: 120px) 100vw, 120px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>This is what the agent actually sees</p></figcaption>\n  </figure></p>\n<p>Because the game does speed up after a while, we attempt to capture part of this information by collating 4 latest screenshots for every observation - which is also what the authors of the original Deep Q Learning on Atari games paper did.</p>\n<ul>\n<li><code class=\"language-text\">reward</code>: Reward modeling is arguably the hardest part of Reinforcement learning: RL is notorious for exploiting the environment. For example, if a game was designed that the score increases when you take respawnable power-ups, and the score is used as the model's reward, the model would learn to repeatedly take the power-up rather than get to the goal and finish the game, which is what happens here:</li>\n</ul>\n<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/tlOIHko8ySg\" frameborder=\"0\" allow=\"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>\n<p><em>This agent actually manages to get ~20% higher scores than human players</em></p>\n<p>In our case, we can either use the score as the reward or, because we prefer stepwise reward to overall reward (easier for the model), just <code class=\"language-text\">.1</code> if the dinosaur still survives and <code class=\"language-text\">-1</code> when it crashes. This is to make the model disproportionately penalizes the agent when it crashes. This detail is unimportant, however, as most algorithms also considers episode-wise rewards, which would be the final score after the game ended.</p>\n<p>In this case, the reward is straightforward because our goal - to survive as long as possible - is simple to model. Other games may require some trial and error for this step. Because how Reinforcement Learning works is first <em>random exploration</em>, essentially throwing things at the wall to see what sticks, it might never get to the goal if it's too hard to randomly press buttons and get to checkpoints or goals for rewards. That's why - for example - a game of <em>snake</em> may require the <em>distance between the snake's head and the pellet</em> to be factored into the reward.</p>\n<ul>\n<li><code class=\"language-text\">done</code> is just a boolean value to indicate whether the game has ended.</li>\n</ul>\n<p>And finally,</p>\n<ul>\n<li><code class=\"language-text\">extra_info</code> is any extra information that does not fit into the other return values, often used for logging purposes. You can just return a <code class=\"language-text\">None</code> or empty <code class=\"language-text\">{}</code> value instead.</li>\n</ul>\n<h1>Use stable-baselines to validate the environment</h1>\n<hr>\n<p>We can lift code straight out of <code class=\"language-text\">stable-baselines</code>'s <a href=\"https://stable-baselines.readthedocs.io/en/master/guide/examples.html?highlight=gif#id2\">examples</a> and modify it <em>just</em> a bit to fit our needs.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> os\n\n<span class=\"token keyword\">from</span> stable_baselines <span class=\"token keyword\">import</span> DQN\n<span class=\"token keyword\">from</span> stable_baselines<span class=\"token punctuation\">.</span>deepq<span class=\"token punctuation\">.</span>policies <span class=\"token keyword\">import</span> CnnPolicy\n<span class=\"token keyword\">from</span> stable_baselines<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>vec_env <span class=\"token keyword\">import</span> DummyVecEnv\n\nenv_lambda <span class=\"token operator\">=</span> <span class=\"token keyword\">lambda</span><span class=\"token punctuation\">:</span> ChromeDinoEnv<span class=\"token punctuation\">(</span>\n    screen_width<span class=\"token operator\">=</span><span class=\"token number\">96</span><span class=\"token punctuation\">,</span>\n    screen_height<span class=\"token operator\">=</span><span class=\"token number\">96</span><span class=\"token punctuation\">,</span>\n    chromedriver_path<span class=\"token operator\">=</span>os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>\n        os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>dirname<span class=\"token punctuation\">(</span>os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>abspath<span class=\"token punctuation\">(</span>__file__<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"chromedriver\"</span>\n    <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">)</span>\nsave_path <span class=\"token operator\">=</span> <span class=\"token string\">\"chrome_dino_dqn_cnn\"</span>\nenv <span class=\"token operator\">=</span> DummyVecEnv<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>env_lambda<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\nmodel <span class=\"token operator\">=</span> DQN<span class=\"token punctuation\">(</span>\n    CnnPolicy<span class=\"token punctuation\">,</span>\n    env<span class=\"token punctuation\">,</span>\n    verbose<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    tensorboard_log<span class=\"token operator\">=</span><span class=\"token string\">\"./.tb_chromedino_env/\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span>\nmodel<span class=\"token punctuation\">.</span>learn<span class=\"token punctuation\">(</span>total_timesteps<span class=\"token operator\">=</span><span class=\"token number\">100000</span><span class=\"token punctuation\">)</span>\nmodel<span class=\"token punctuation\">.</span>save<span class=\"token punctuation\">(</span>save_path<span class=\"token punctuation\">)</span>\n\nmodel <span class=\"token operator\">=</span> DQN<span class=\"token punctuation\">.</span>load<span class=\"token punctuation\">(</span>save_path<span class=\"token punctuation\">,</span> env<span class=\"token operator\">=</span>env<span class=\"token punctuation\">)</span>\n\nobs <span class=\"token operator\">=</span> env<span class=\"token punctuation\">.</span>reset<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n    action<span class=\"token punctuation\">,</span> _states <span class=\"token operator\">=</span> model<span class=\"token punctuation\">.</span>predict<span class=\"token punctuation\">(</span>obs<span class=\"token punctuation\">)</span>\n    obs<span class=\"token punctuation\">,</span> reward<span class=\"token punctuation\">,</span> done<span class=\"token punctuation\">,</span> info <span class=\"token operator\">=</span> env<span class=\"token punctuation\">.</span>step<span class=\"token punctuation\">(</span>action<span class=\"token punctuation\">)</span>\n    env<span class=\"token punctuation\">.</span>render<span class=\"token punctuation\">(</span>mode<span class=\"token operator\">=</span><span class=\"token string\">\"human\"</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>This will lead to pretty decent results - if only for demonstrative purposes. You can increase the number of training timesteps for better results (might take a few million steps to master the game). It will, by default, use Deep-Q Learning along with extensions (Dueling, Double-DQN and Prioritized Experience Replay).</p>\n<p>As <code class=\"language-text\">DQN</code> does not support multiprocessing, however, we can opt for <code class=\"language-text\">PPO</code> to hasten the training process. Important note though: even if I can use these algorithms interchangeably in these cases, a lot of times, some algorithms are designed for certain scenarios, while others might not even converge on certain problems. It might even take some trial and error to choose the right algorithm. A starting guideline can be found on <code class=\"language-text\">stable-baselines</code> docs: <a href=\"https://stable-baselines.readthedocs.io/en/master/guide/rl_tips.html#which-algorithm-should-i-use\">https://stable-baselines.readthedocs.io/en/master/guide/rl_tips.html#which-algorithm-should-i-use</a></p>\n<p>With this we can train and run 4 agents at once, simultaneously - which can speed up training by a lot. Here is an agent that has been trained for a few hours with the <code class=\"language-text\">PPO</code> algorithm: (screenshots are taken directly from Chrome, the black background is due to transparency)</p>\n<p><img src=\"/static/271fdad092161b2156e5cad8e5925a6b/chrome-dino-game-reinforcement-learning-observation-agent.gif\" alt=\"Running 4 instances at once with a trained agent\"></p>\n<p>The complete version of the code can be found here:</p>\n<p><div id=\"gist103736652\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-gym_chrome_dino_game-py\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-python \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>import</span> <span class=pl-s1>numpy</span> <span class=pl-k>as</span> <span class=pl-s1>np</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC2\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>import</span> <span class=pl-s1>os</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC3\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>import</span> <span class=pl-s1>gym</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC4\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>from</span> <span class=pl-s1>gym</span> <span class=pl-k>import</span> <span class=pl-s1>error</span>, <span class=pl-s1>spaces</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC5\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>from</span> <span class=pl-s1>collections</span> <span class=pl-k>import</span> <span class=pl-s1>deque</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC6\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC7\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>from</span> <span class=pl-s1>io</span> <span class=pl-k>import</span> <span class=pl-v>BytesIO</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC8\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>from</span> <span class=pl-v>PIL</span> <span class=pl-k>import</span> <span class=pl-v>Image</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC9\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>import</span> <span class=pl-s1>base64</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC10\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>import</span> <span class=pl-s1>cv2</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC11\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC12\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>from</span> <span class=pl-s1>selenium</span> <span class=pl-k>import</span> <span class=pl-s1>webdriver</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC13\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>from</span> <span class=pl-s1>selenium</span>.<span class=pl-s1>webdriver</span>.<span class=pl-s1>common</span>.<span class=pl-s1>keys</span> <span class=pl-k>import</span> <span class=pl-v>Keys</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC14\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>from</span> <span class=pl-s1>selenium</span>.<span class=pl-s1>webdriver</span>.<span class=pl-s1>common</span>.<span class=pl-s1>by</span> <span class=pl-k>import</span> <span class=pl-v>By</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC15\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>from</span> <span class=pl-s1>selenium</span>.<span class=pl-s1>webdriver</span>.<span class=pl-s1>common</span>.<span class=pl-s1>action_chains</span> <span class=pl-k>import</span> <span class=pl-v>ActionChains</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC16\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>from</span> <span class=pl-s1>selenium</span>.<span class=pl-s1>webdriver</span>.<span class=pl-s1>support</span>.<span class=pl-s1>ui</span> <span class=pl-k>import</span> <span class=pl-v>WebDriverWait</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC17\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>from</span> <span class=pl-s1>selenium</span>.<span class=pl-s1>webdriver</span>.<span class=pl-s1>support</span> <span class=pl-k>import</span> <span class=pl-s1>expected_conditions</span> <span class=pl-k>as</span> <span class=pl-v>EC</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC18\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC19\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>import</span> <span class=pl-s1>time</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC20\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC21\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>class</span> <span class=pl-v>ChromeDinoEnv</span>(<span class=pl-s1>gym</span>.<span class=pl-v>Env</span>):</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC22\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC23\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-k>def</span> <span class=pl-en>__init__</span>(<span class=pl-s1>self</span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC24\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>screen_width</span>: <span class=pl-s1>int</span><span class=pl-c1>=</span><span class=pl-c1>120</span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC25\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>screen_height</span>: <span class=pl-s1>int</span><span class=pl-c1>=</span><span class=pl-c1>120</span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC26\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>chromedriver_path</span>: <span class=pl-s1>str</span><span class=pl-c1>=</span><span class=pl-s>&quot;chromedriver&quot;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC27\" class=\"blob-code blob-code-inner js-file-line\">        ):</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC28\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>self</span>.<span class=pl-s1>screen_width</span> <span class=pl-c1>=</span> <span class=pl-s1>screen_width</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L29\" class=\"blob-num js-line-number\" data-line-number=\"29\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC29\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>self</span>.<span class=pl-s1>screen_height</span> <span class=pl-c1>=</span> <span class=pl-s1>screen_height</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L30\" class=\"blob-num js-line-number\" data-line-number=\"30\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC30\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>self</span>.<span class=pl-s1>chromedriver_path</span> <span class=pl-c1>=</span> <span class=pl-s1>chromedriver_path</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L31\" class=\"blob-num js-line-number\" data-line-number=\"31\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC31\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L32\" class=\"blob-num js-line-number\" data-line-number=\"32\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC32\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>self</span>.<span class=pl-s1>action_space</span> <span class=pl-c1>=</span> <span class=pl-s1>spaces</span>.<span class=pl-v>Discrete</span>(<span class=pl-c1>3</span>) <span class=pl-c># do nothing, up, down</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L33\" class=\"blob-num js-line-number\" data-line-number=\"33\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC33\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>self</span>.<span class=pl-s1>observation_space</span> <span class=pl-c1>=</span> <span class=pl-s1>spaces</span>.<span class=pl-v>Box</span>(</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L34\" class=\"blob-num js-line-number\" data-line-number=\"34\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC34\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>low</span><span class=pl-c1>=</span><span class=pl-c1>0</span>, </td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L35\" class=\"blob-num js-line-number\" data-line-number=\"35\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC35\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>high</span><span class=pl-c1>=</span><span class=pl-c1>255</span>, </td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L36\" class=\"blob-num js-line-number\" data-line-number=\"36\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC36\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>shape</span><span class=pl-c1>=</span>(<span class=pl-s1>self</span>.<span class=pl-s1>screen_width</span>, <span class=pl-s1>self</span>.<span class=pl-s1>screen_height</span>, <span class=pl-c1>4</span>), </td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L37\" class=\"blob-num js-line-number\" data-line-number=\"37\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC37\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>dtype</span><span class=pl-c1>=</span><span class=pl-s1>np</span>.<span class=pl-s1>uint8</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L38\" class=\"blob-num js-line-number\" data-line-number=\"38\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC38\" class=\"blob-code blob-code-inner js-file-line\">        )</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L39\" class=\"blob-num js-line-number\" data-line-number=\"39\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC39\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L40\" class=\"blob-num js-line-number\" data-line-number=\"40\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC40\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>_chrome_options</span> <span class=pl-c1>=</span> <span class=pl-s1>webdriver</span>.<span class=pl-v>ChromeOptions</span>()</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L41\" class=\"blob-num js-line-number\" data-line-number=\"41\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC41\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>_chrome_options</span>.<span class=pl-en>add_argument</span>(<span class=pl-s>&quot;--mute-audio&quot;</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L42\" class=\"blob-num js-line-number\" data-line-number=\"42\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC42\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-c># _chrome_options.add_argument(&quot;--disable-gpu&quot;) # if running on Windows</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L43\" class=\"blob-num js-line-number\" data-line-number=\"43\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC43\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L44\" class=\"blob-num js-line-number\" data-line-number=\"44\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC44\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>self</span>.<span class=pl-s1>_driver</span> <span class=pl-c1>=</span> <span class=pl-s1>webdriver</span>.<span class=pl-v>Chrome</span>(</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L45\" class=\"blob-num js-line-number\" data-line-number=\"45\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC45\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>executable_path</span><span class=pl-c1>=</span><span class=pl-s1>self</span>.<span class=pl-s1>chromedriver_path</span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L46\" class=\"blob-num js-line-number\" data-line-number=\"46\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC46\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>chrome_options</span><span class=pl-c1>=</span><span class=pl-s1>_chrome_options</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L47\" class=\"blob-num js-line-number\" data-line-number=\"47\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC47\" class=\"blob-code blob-code-inner js-file-line\">        )</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L48\" class=\"blob-num js-line-number\" data-line-number=\"48\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC48\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>self</span>.<span class=pl-s1>current_key</span> <span class=pl-c1>=</span> <span class=pl-c1>None</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L49\" class=\"blob-num js-line-number\" data-line-number=\"49\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC49\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>self</span>.<span class=pl-s1>state_queue</span> <span class=pl-c1>=</span> <span class=pl-en>deque</span>(<span class=pl-s1>maxlen</span><span class=pl-c1>=</span><span class=pl-c1>4</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L50\" class=\"blob-num js-line-number\" data-line-number=\"50\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC50\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L51\" class=\"blob-num js-line-number\" data-line-number=\"51\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC51\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>self</span>.<span class=pl-s1>actions_map</span> <span class=pl-c1>=</span> [</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L52\" class=\"blob-num js-line-number\" data-line-number=\"52\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC52\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-v>Keys</span>.<span class=pl-v>ARROW_RIGHT</span>, <span class=pl-c># do nothing</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L53\" class=\"blob-num js-line-number\" data-line-number=\"53\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC53\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-v>Keys</span>.<span class=pl-v>ARROW_UP</span>, <span class=pl-c># jump</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L54\" class=\"blob-num js-line-number\" data-line-number=\"54\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC54\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-v>Keys</span>.<span class=pl-v>ARROW_DOWN</span> <span class=pl-c># duck</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L55\" class=\"blob-num js-line-number\" data-line-number=\"55\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC55\" class=\"blob-code blob-code-inner js-file-line\">        ]</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L56\" class=\"blob-num js-line-number\" data-line-number=\"56\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC56\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>action_chains</span> <span class=pl-c1>=</span> <span class=pl-v>ActionChains</span>(<span class=pl-s1>self</span>.<span class=pl-s1>_driver</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L57\" class=\"blob-num js-line-number\" data-line-number=\"57\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC57\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>self</span>.<span class=pl-s1>keydown_actions</span> <span class=pl-c1>=</span> [<span class=pl-s1>action_chains</span>.<span class=pl-en>key_down</span>(<span class=pl-s1>item</span>) <span class=pl-k>for</span> <span class=pl-s1>item</span> <span class=pl-c1>in</span> <span class=pl-s1>self</span>.<span class=pl-s1>actions_map</span>]</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L58\" class=\"blob-num js-line-number\" data-line-number=\"58\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC58\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>self</span>.<span class=pl-s1>keyup_actions</span> <span class=pl-c1>=</span> [<span class=pl-s1>action_chains</span>.<span class=pl-en>key_up</span>(<span class=pl-s1>item</span>) <span class=pl-k>for</span> <span class=pl-s1>item</span> <span class=pl-c1>in</span> <span class=pl-s1>self</span>.<span class=pl-s1>actions_map</span>]</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L59\" class=\"blob-num js-line-number\" data-line-number=\"59\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC59\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L60\" class=\"blob-num js-line-number\" data-line-number=\"60\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC60\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-k>def</span> <span class=pl-en>reset</span>(<span class=pl-s1>self</span>):</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L61\" class=\"blob-num js-line-number\" data-line-number=\"61\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC61\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>self</span>.<span class=pl-s1>_driver</span>.<span class=pl-en>get</span>(<span class=pl-s>&#39;chrome://dino&#39;</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L62\" class=\"blob-num js-line-number\" data-line-number=\"62\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC62\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-v>WebDriverWait</span>(<span class=pl-s1>self</span>.<span class=pl-s1>_driver</span>, <span class=pl-c1>10</span>).<span class=pl-en>until</span>(</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L63\" class=\"blob-num js-line-number\" data-line-number=\"63\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC63\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-v>EC</span>.<span class=pl-en>presence_of_element_located</span>((</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L64\" class=\"blob-num js-line-number\" data-line-number=\"64\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC64\" class=\"blob-code blob-code-inner js-file-line\">                <span class=pl-v>By</span>.<span class=pl-v>CLASS_NAME</span>, </td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L65\" class=\"blob-num js-line-number\" data-line-number=\"65\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC65\" class=\"blob-code blob-code-inner js-file-line\">                <span class=pl-s>&quot;runner-canvas&quot;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L66\" class=\"blob-num js-line-number\" data-line-number=\"66\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC66\" class=\"blob-code blob-code-inner js-file-line\">            ))</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L67\" class=\"blob-num js-line-number\" data-line-number=\"67\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC67\" class=\"blob-code blob-code-inner js-file-line\">        )</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L68\" class=\"blob-num js-line-number\" data-line-number=\"68\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC68\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L69\" class=\"blob-num js-line-number\" data-line-number=\"69\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC69\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-c># trigger game start</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L70\" class=\"blob-num js-line-number\" data-line-number=\"70\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC70\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>self</span>.<span class=pl-s1>_driver</span>.<span class=pl-en>find_element_by_tag_name</span>(<span class=pl-s>&quot;body&quot;</span>).<span class=pl-en>send_keys</span>(<span class=pl-v>Keys</span>.<span class=pl-v>SPACE</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L71\" class=\"blob-num js-line-number\" data-line-number=\"71\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC71\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L72\" class=\"blob-num js-line-number\" data-line-number=\"72\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC72\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-k>return</span> <span class=pl-s1>self</span>.<span class=pl-en>_next_observation</span>()</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L73\" class=\"blob-num js-line-number\" data-line-number=\"73\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC73\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L74\" class=\"blob-num js-line-number\" data-line-number=\"74\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC74\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-k>def</span> <span class=pl-en>_get_image</span>(<span class=pl-s1>self</span>):</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L75\" class=\"blob-num js-line-number\" data-line-number=\"75\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC75\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-v>LEADING_TEXT</span> <span class=pl-c1>=</span> <span class=pl-s>&quot;data:image/png;base64,&quot;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L76\" class=\"blob-num js-line-number\" data-line-number=\"76\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC76\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>_img</span> <span class=pl-c1>=</span> <span class=pl-s1>self</span>.<span class=pl-s1>_driver</span>.<span class=pl-en>execute_script</span>(</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L77\" class=\"blob-num js-line-number\" data-line-number=\"77\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC77\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s>&quot;return document.querySelector(&#39;canvas.runner-canvas&#39;).toDataURL()&quot;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L78\" class=\"blob-num js-line-number\" data-line-number=\"78\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC78\" class=\"blob-code blob-code-inner js-file-line\">        )</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L79\" class=\"blob-num js-line-number\" data-line-number=\"79\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC79\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>_img</span> <span class=pl-c1>=</span> <span class=pl-s1>_img</span>[<span class=pl-en>len</span>(<span class=pl-v>LEADING_TEXT</span>):]</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L80\" class=\"blob-num js-line-number\" data-line-number=\"80\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC80\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-k>return</span> <span class=pl-s1>np</span>.<span class=pl-en>array</span>(</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L81\" class=\"blob-num js-line-number\" data-line-number=\"81\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC81\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-v>Image</span>.<span class=pl-en>open</span>(<span class=pl-v>BytesIO</span>(<span class=pl-s1>base64</span>.<span class=pl-en>b64decode</span>(<span class=pl-s1>_img</span>)))</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L82\" class=\"blob-num js-line-number\" data-line-number=\"82\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC82\" class=\"blob-code blob-code-inner js-file-line\">        )</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L83\" class=\"blob-num js-line-number\" data-line-number=\"83\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC83\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L84\" class=\"blob-num js-line-number\" data-line-number=\"84\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC84\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-k>def</span> <span class=pl-en>_next_observation</span>(<span class=pl-s1>self</span>):</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L85\" class=\"blob-num js-line-number\" data-line-number=\"85\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC85\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>image</span> <span class=pl-c1>=</span> <span class=pl-s1>cv2</span>.<span class=pl-en>cvtColor</span>(<span class=pl-s1>self</span>.<span class=pl-en>_get_image</span>(), <span class=pl-s1>cv2</span>.<span class=pl-v>COLOR_BGR2GRAY</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L86\" class=\"blob-num js-line-number\" data-line-number=\"86\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC86\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>image</span> <span class=pl-c1>=</span> <span class=pl-s1>image</span>[:<span class=pl-c1>500</span>, :<span class=pl-c1>480</span>] <span class=pl-c># cropping</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L87\" class=\"blob-num js-line-number\" data-line-number=\"87\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC87\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>image</span> <span class=pl-c1>=</span> <span class=pl-s1>cv2</span>.<span class=pl-en>resize</span>(<span class=pl-s1>image</span>, (<span class=pl-s1>self</span>.<span class=pl-s1>screen_width</span>, <span class=pl-s1>self</span>.<span class=pl-s1>screen_height</span>))</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L88\" class=\"blob-num js-line-number\" data-line-number=\"88\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC88\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L89\" class=\"blob-num js-line-number\" data-line-number=\"89\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC89\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>self</span>.<span class=pl-s1>state_queue</span>.<span class=pl-en>append</span>(<span class=pl-s1>image</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L90\" class=\"blob-num js-line-number\" data-line-number=\"90\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC90\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L91\" class=\"blob-num js-line-number\" data-line-number=\"91\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC91\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-k>if</span> <span class=pl-en>len</span>(<span class=pl-s1>self</span>.<span class=pl-s1>state_queue</span>) <span class=pl-c1>&lt;</span> <span class=pl-c1>4</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L92\" class=\"blob-num js-line-number\" data-line-number=\"92\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC92\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-k>return</span> <span class=pl-s1>np</span>.<span class=pl-en>stack</span>([<span class=pl-s1>image</span>] <span class=pl-c1>*</span> <span class=pl-c1>4</span>, <span class=pl-s1>axis</span><span class=pl-c1>=</span><span class=pl-c1>-</span><span class=pl-c1>1</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L93\" class=\"blob-num js-line-number\" data-line-number=\"93\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC93\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-k>else</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L94\" class=\"blob-num js-line-number\" data-line-number=\"94\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC94\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-k>return</span> <span class=pl-s1>np</span>.<span class=pl-en>stack</span>(<span class=pl-s1>self</span>.<span class=pl-s1>state_queue</span>, <span class=pl-s1>axis</span><span class=pl-c1>=</span><span class=pl-c1>-</span><span class=pl-c1>1</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L95\" class=\"blob-num js-line-number\" data-line-number=\"95\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC95\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L96\" class=\"blob-num js-line-number\" data-line-number=\"96\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC96\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-k>return</span> <span class=pl-s1>image</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L97\" class=\"blob-num js-line-number\" data-line-number=\"97\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC97\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L98\" class=\"blob-num js-line-number\" data-line-number=\"98\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC98\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-k>def</span> <span class=pl-en>_get_score</span>(<span class=pl-s1>self</span>):</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L99\" class=\"blob-num js-line-number\" data-line-number=\"99\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC99\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-k>return</span> <span class=pl-en>int</span>(<span class=pl-s>&#39;&#39;</span>.<span class=pl-en>join</span>(</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L100\" class=\"blob-num js-line-number\" data-line-number=\"100\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC100\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>self</span>.<span class=pl-s1>_driver</span>.<span class=pl-en>execute_script</span>(<span class=pl-s>&quot;return Runner.instance_.distanceMeter.digits&quot;</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L101\" class=\"blob-num js-line-number\" data-line-number=\"101\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC101\" class=\"blob-code blob-code-inner js-file-line\">        ))</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L102\" class=\"blob-num js-line-number\" data-line-number=\"102\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC102\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L103\" class=\"blob-num js-line-number\" data-line-number=\"103\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC103\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-k>def</span> <span class=pl-en>_get_done</span>(<span class=pl-s1>self</span>):</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L104\" class=\"blob-num js-line-number\" data-line-number=\"104\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC104\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-k>return</span> <span class=pl-c1>not</span> <span class=pl-s1>self</span>.<span class=pl-s1>_driver</span>.<span class=pl-en>execute_script</span>(<span class=pl-s>&quot;return Runner.instance_.playing&quot;</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L105\" class=\"blob-num js-line-number\" data-line-number=\"105\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC105\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L106\" class=\"blob-num js-line-number\" data-line-number=\"106\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC106\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-k>def</span> <span class=pl-en>step</span>(<span class=pl-s1>self</span>, <span class=pl-s1>action</span>: <span class=pl-s1>int</span>):</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L107\" class=\"blob-num js-line-number\" data-line-number=\"107\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC107\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>self</span>.<span class=pl-s1>_driver</span>.<span class=pl-en>find_element_by_tag_name</span>(<span class=pl-s>&quot;body&quot;</span>) \\</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L108\" class=\"blob-num js-line-number\" data-line-number=\"108\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC108\" class=\"blob-code blob-code-inner js-file-line\">            .<span class=pl-en>send_keys</span>(<span class=pl-s1>self</span>.<span class=pl-s1>actions_map</span>[<span class=pl-s1>action</span>])</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L109\" class=\"blob-num js-line-number\" data-line-number=\"109\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC109\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L110\" class=\"blob-num js-line-number\" data-line-number=\"110\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC110\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>obs</span> <span class=pl-c1>=</span> <span class=pl-s1>self</span>.<span class=pl-en>_next_observation</span>()</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L111\" class=\"blob-num js-line-number\" data-line-number=\"111\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC111\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L112\" class=\"blob-num js-line-number\" data-line-number=\"112\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC112\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>done</span> <span class=pl-c1>=</span> <span class=pl-s1>self</span>.<span class=pl-en>_get_done</span>()</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L113\" class=\"blob-num js-line-number\" data-line-number=\"113\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC113\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>reward</span> <span class=pl-c1>=</span> <span class=pl-c1>.1</span> <span class=pl-k>if</span> <span class=pl-c1>not</span> <span class=pl-s1>done</span> <span class=pl-k>else</span> <span class=pl-c1>-</span><span class=pl-c1>1</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L114\" class=\"blob-num js-line-number\" data-line-number=\"114\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC114\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L115\" class=\"blob-num js-line-number\" data-line-number=\"115\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC115\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>time</span>.<span class=pl-en>sleep</span>(<span class=pl-c1>.015</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L116\" class=\"blob-num js-line-number\" data-line-number=\"116\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC116\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L117\" class=\"blob-num js-line-number\" data-line-number=\"117\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC117\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-k>return</span> <span class=pl-s1>obs</span>, <span class=pl-s1>reward</span>, <span class=pl-s1>done</span>, {<span class=pl-s>&quot;score&quot;</span>: <span class=pl-s1>self</span>.<span class=pl-en>_get_score</span>()}</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L118\" class=\"blob-num js-line-number\" data-line-number=\"118\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC118\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L119\" class=\"blob-num js-line-number\" data-line-number=\"119\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC119\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-k>def</span> <span class=pl-en>render</span>(<span class=pl-s1>self</span>, <span class=pl-s1>mode</span>: <span class=pl-s1>str</span><span class=pl-c1>=</span><span class=pl-s>&#39;human&#39;</span>):</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L120\" class=\"blob-num js-line-number\" data-line-number=\"120\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC120\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>img</span> <span class=pl-c1>=</span> <span class=pl-s1>cv2</span>.<span class=pl-en>cvtColor</span>(<span class=pl-s1>self</span>.<span class=pl-en>_get_image</span>(), <span class=pl-s1>cv2</span>.<span class=pl-v>COLOR_BGR2RGB</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L121\" class=\"blob-num js-line-number\" data-line-number=\"121\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC121\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-k>if</span> <span class=pl-s1>mode</span> <span class=pl-c1>==</span> <span class=pl-s>&#39;rgb_array&#39;</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L122\" class=\"blob-num js-line-number\" data-line-number=\"122\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC122\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-k>return</span> <span class=pl-s1>img</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L123\" class=\"blob-num js-line-number\" data-line-number=\"123\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC123\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-k>elif</span> <span class=pl-s1>mode</span> <span class=pl-c1>==</span> <span class=pl-s>&#39;human&#39;</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L124\" class=\"blob-num js-line-number\" data-line-number=\"124\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC124\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-k>from</span> <span class=pl-s1>gym</span>.<span class=pl-s1>envs</span>.<span class=pl-s1>classic_control</span> <span class=pl-k>import</span> <span class=pl-s1>rendering</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L125\" class=\"blob-num js-line-number\" data-line-number=\"125\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC125\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-k>if</span> <span class=pl-s1>self</span>.<span class=pl-s1>viewer</span> <span class=pl-c1>is</span> <span class=pl-c1>None</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L126\" class=\"blob-num js-line-number\" data-line-number=\"126\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC126\" class=\"blob-code blob-code-inner js-file-line\">                <span class=pl-s1>self</span>.<span class=pl-s1>viewer</span> <span class=pl-c1>=</span> <span class=pl-s1>rendering</span>.<span class=pl-v>SimpleImageViewer</span>()</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L127\" class=\"blob-num js-line-number\" data-line-number=\"127\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC127\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>self</span>.<span class=pl-s1>viewer</span>.<span class=pl-en>imshow</span>(<span class=pl-s1>img</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L128\" class=\"blob-num js-line-number\" data-line-number=\"128\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC128\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-k>return</span> <span class=pl-s1>self</span>.<span class=pl-s1>viewer</span>.<span class=pl-s1>isopen</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L129\" class=\"blob-num js-line-number\" data-line-number=\"129\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC129\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L130\" class=\"blob-num js-line-number\" data-line-number=\"130\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC130\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-k>def</span> <span class=pl-en>close</span>(<span class=pl-s1>self</span>):</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L131\" class=\"blob-num js-line-number\" data-line-number=\"131\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC131\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-k>if</span> <span class=pl-s1>self</span>.<span class=pl-s1>viewer</span> <span class=pl-c1>is</span> <span class=pl-c1>not</span> <span class=pl-c1>None</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L132\" class=\"blob-num js-line-number\" data-line-number=\"132\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC132\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>self</span>.<span class=pl-s1>viewer</span>.<span class=pl-en>close</span>()</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L133\" class=\"blob-num js-line-number\" data-line-number=\"133\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC133\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>self</span>.<span class=pl-s1>viewer</span> <span class=pl-c1>=</span> <span class=pl-c1>None</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L134\" class=\"blob-num js-line-number\" data-line-number=\"134\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC134\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L135\" class=\"blob-num js-line-number\" data-line-number=\"135\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC135\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>import</span> <span class=pl-s1>imageio</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L136\" class=\"blob-num js-line-number\" data-line-number=\"136\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC136\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L137\" class=\"blob-num js-line-number\" data-line-number=\"137\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC137\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>from</span> <span class=pl-s1>tqdm</span> <span class=pl-k>import</span> <span class=pl-s1>tqdm</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L138\" class=\"blob-num js-line-number\" data-line-number=\"138\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC138\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L139\" class=\"blob-num js-line-number\" data-line-number=\"139\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC139\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>from</span> <span class=pl-s1>stable_baselines</span> <span class=pl-k>import</span> <span class=pl-v>PPO2</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L140\" class=\"blob-num js-line-number\" data-line-number=\"140\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC140\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>from</span> <span class=pl-s1>stable_baselines</span>.<span class=pl-s1>common</span>.<span class=pl-s1>policies</span> <span class=pl-k>import</span> <span class=pl-v>CnnPolicy</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L141\" class=\"blob-num js-line-number\" data-line-number=\"141\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC141\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>from</span> <span class=pl-s1>stable_baselines</span>.<span class=pl-s1>common</span>.<span class=pl-s1>vec_env</span> <span class=pl-k>import</span> <span class=pl-v>SubprocVecEnv</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L142\" class=\"blob-num js-line-number\" data-line-number=\"142\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC142\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>from</span> <span class=pl-s1>stable_baselines</span>.<span class=pl-s1>common</span>.<span class=pl-s1>callbacks</span> <span class=pl-k>import</span> <span class=pl-v>CheckpointCallback</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L143\" class=\"blob-num js-line-number\" data-line-number=\"143\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC143\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L144\" class=\"blob-num js-line-number\" data-line-number=\"144\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC144\" class=\"blob-code blob-code-inner js-file-line\"><span class=pl-k>if</span> <span class=pl-s1>__name__</span> <span class=pl-c1>==</span> <span class=pl-s>&#39;__main__&#39;</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L145\" class=\"blob-num js-line-number\" data-line-number=\"145\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC145\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-s1>env_lambda</span> <span class=pl-c1>=</span> <span class=pl-k>lambda</span>: <span class=pl-v>ChromeDinoEnv</span>(</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L146\" class=\"blob-num js-line-number\" data-line-number=\"146\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC146\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>screen_width</span><span class=pl-c1>=</span><span class=pl-c1>96</span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L147\" class=\"blob-num js-line-number\" data-line-number=\"147\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC147\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>screen_height</span><span class=pl-c1>=</span><span class=pl-c1>96</span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L148\" class=\"blob-num js-line-number\" data-line-number=\"148\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC148\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>chromedriver_path</span><span class=pl-c1>=</span><span class=pl-s1>os</span>.<span class=pl-s1>path</span>.<span class=pl-en>join</span>(</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L149\" class=\"blob-num js-line-number\" data-line-number=\"149\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC149\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>os</span>.<span class=pl-s1>path</span>.<span class=pl-en>dirname</span>(<span class=pl-s1>os</span>.<span class=pl-s1>path</span>.<span class=pl-en>abspath</span>(<span class=pl-s1>__file__</span>)),</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L150\" class=\"blob-num js-line-number\" data-line-number=\"150\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC150\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s>&quot;chromedriver&quot;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L151\" class=\"blob-num js-line-number\" data-line-number=\"151\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC151\" class=\"blob-code blob-code-inner js-file-line\">        )</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L152\" class=\"blob-num js-line-number\" data-line-number=\"152\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC152\" class=\"blob-code blob-code-inner js-file-line\">    )</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L153\" class=\"blob-num js-line-number\" data-line-number=\"153\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC153\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-s1>do_train</span> <span class=pl-c1>=</span> <span class=pl-c1>False</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L154\" class=\"blob-num js-line-number\" data-line-number=\"154\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC154\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-s1>num_cpu</span> <span class=pl-c1>=</span> <span class=pl-c1>4</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L155\" class=\"blob-num js-line-number\" data-line-number=\"155\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC155\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-s1>save_path</span> <span class=pl-c1>=</span> <span class=pl-s>&quot;chrome_dino_ppo_cnn&quot;</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L156\" class=\"blob-num js-line-number\" data-line-number=\"156\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC156\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-s1>env</span> <span class=pl-c1>=</span> <span class=pl-v>SubprocVecEnv</span>([<span class=pl-s1>env_lambda</span> <span class=pl-k>for</span> <span class=pl-s1>i</span> <span class=pl-c1>in</span> <span class=pl-en>range</span>(<span class=pl-s1>num_cpu</span>)])</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L157\" class=\"blob-num js-line-number\" data-line-number=\"157\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC157\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L158\" class=\"blob-num js-line-number\" data-line-number=\"158\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC158\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-k>if</span> <span class=pl-s1>do_train</span>:</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L159\" class=\"blob-num js-line-number\" data-line-number=\"159\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC159\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>checkpoint_callback</span> <span class=pl-c1>=</span> <span class=pl-v>CheckpointCallback</span>(</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L160\" class=\"blob-num js-line-number\" data-line-number=\"160\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC160\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>save_freq</span><span class=pl-c1>=</span><span class=pl-c1>200000</span>, </td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L161\" class=\"blob-num js-line-number\" data-line-number=\"161\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC161\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>save_path</span><span class=pl-c1>=</span><span class=pl-s>&#39;./.checkpoints/&#39;</span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L162\" class=\"blob-num js-line-number\" data-line-number=\"162\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC162\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>name_prefix</span><span class=pl-c1>=</span><span class=pl-s1>save_path</span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L163\" class=\"blob-num js-line-number\" data-line-number=\"163\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC163\" class=\"blob-code blob-code-inner js-file-line\">        )</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L164\" class=\"blob-num js-line-number\" data-line-number=\"164\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC164\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>model</span> <span class=pl-c1>=</span> <span class=pl-v>PPO2</span>(</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L165\" class=\"blob-num js-line-number\" data-line-number=\"165\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC165\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-v>CnnPolicy</span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L166\" class=\"blob-num js-line-number\" data-line-number=\"166\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC166\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>env</span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L167\" class=\"blob-num js-line-number\" data-line-number=\"167\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC167\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>verbose</span><span class=pl-c1>=</span><span class=pl-c1>1</span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L168\" class=\"blob-num js-line-number\" data-line-number=\"168\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC168\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>tensorboard_log</span><span class=pl-c1>=</span><span class=pl-s>&quot;./.tb_chromedino_env/&quot;</span>,</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L169\" class=\"blob-num js-line-number\" data-line-number=\"169\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC169\" class=\"blob-code blob-code-inner js-file-line\">        )</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L170\" class=\"blob-num js-line-number\" data-line-number=\"170\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC170\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>model</span>.<span class=pl-en>learn</span>(</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L171\" class=\"blob-num js-line-number\" data-line-number=\"171\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC171\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>total_timesteps</span><span class=pl-c1>=</span><span class=pl-c1>2000000</span>, </td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L172\" class=\"blob-num js-line-number\" data-line-number=\"172\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC172\" class=\"blob-code blob-code-inner js-file-line\">            <span class=pl-s1>callback</span><span class=pl-c1>=</span>[<span class=pl-s1>checkpoint_callback</span>]</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L173\" class=\"blob-num js-line-number\" data-line-number=\"173\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC173\" class=\"blob-code blob-code-inner js-file-line\">        )</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L174\" class=\"blob-num js-line-number\" data-line-number=\"174\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC174\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>model</span>.<span class=pl-en>save</span>(<span class=pl-s1>save_path</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L175\" class=\"blob-num js-line-number\" data-line-number=\"175\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC175\" class=\"blob-code blob-code-inner js-file-line\">    </td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L176\" class=\"blob-num js-line-number\" data-line-number=\"176\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC176\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-s1>model</span> <span class=pl-c1>=</span> <span class=pl-v>PPO2</span>.<span class=pl-en>load</span>(<span class=pl-s1>save_path</span>, <span class=pl-s1>env</span><span class=pl-c1>=</span><span class=pl-s1>env</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L177\" class=\"blob-num js-line-number\" data-line-number=\"177\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC177\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L178\" class=\"blob-num js-line-number\" data-line-number=\"178\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC178\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-s1>images</span> <span class=pl-c1>=</span> []</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L179\" class=\"blob-num js-line-number\" data-line-number=\"179\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC179\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L180\" class=\"blob-num js-line-number\" data-line-number=\"180\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC180\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-s1>obs</span> <span class=pl-c1>=</span> <span class=pl-s1>env</span>.<span class=pl-en>reset</span>()</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L181\" class=\"blob-num js-line-number\" data-line-number=\"181\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC181\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-s1>img</span> <span class=pl-c1>=</span> <span class=pl-s1>model</span>.<span class=pl-s1>env</span>.<span class=pl-en>render</span>(<span class=pl-s1>mode</span><span class=pl-c1>=</span><span class=pl-s>&#39;rgb_array&#39;</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L182\" class=\"blob-num js-line-number\" data-line-number=\"182\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC182\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L183\" class=\"blob-num js-line-number\" data-line-number=\"183\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC183\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-k>for</span> <span class=pl-s1>i</span> <span class=pl-c1>in</span> <span class=pl-en>tqdm</span>(<span class=pl-en>range</span>(<span class=pl-c1>500</span>)):</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L184\" class=\"blob-num js-line-number\" data-line-number=\"184\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC184\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>images</span>.<span class=pl-en>append</span>(<span class=pl-s1>img</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L185\" class=\"blob-num js-line-number\" data-line-number=\"185\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC185\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>action</span>, <span class=pl-s1>_states</span> <span class=pl-c1>=</span> <span class=pl-s1>model</span>.<span class=pl-en>predict</span>(<span class=pl-s1>obs</span>, <span class=pl-s1>deterministic</span><span class=pl-c1>=</span><span class=pl-c1>True</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L186\" class=\"blob-num js-line-number\" data-line-number=\"186\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC186\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>obs</span>, <span class=pl-s1>rewards</span>, <span class=pl-s1>dones</span>, <span class=pl-s1>info</span> <span class=pl-c1>=</span> <span class=pl-s1>env</span>.<span class=pl-en>step</span>(<span class=pl-s1>action</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L187\" class=\"blob-num js-line-number\" data-line-number=\"187\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC187\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L188\" class=\"blob-num js-line-number\" data-line-number=\"188\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC188\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-c># env.render(mode=&#39;human&#39;)</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L189\" class=\"blob-num js-line-number\" data-line-number=\"189\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC189\" class=\"blob-code blob-code-inner js-file-line\">        </td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L190\" class=\"blob-num js-line-number\" data-line-number=\"190\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC190\" class=\"blob-code blob-code-inner js-file-line\">        <span class=pl-s1>img</span> <span class=pl-c1>=</span> <span class=pl-s1>env</span>.<span class=pl-en>render</span>(<span class=pl-s1>mode</span><span class=pl-c1>=</span><span class=pl-s>&#39;rgb_array&#39;</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L191\" class=\"blob-num js-line-number\" data-line-number=\"191\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC191\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L192\" class=\"blob-num js-line-number\" data-line-number=\"192\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC192\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-s1>imageio</span>.<span class=pl-en>mimsave</span>(<span class=pl-s>&#39;dino.gif&#39;</span>, [<span class=pl-s1>np</span>.<span class=pl-en>array</span>(<span class=pl-s1>img</span>) <span class=pl-k>for</span> <span class=pl-s1>i</span>, <span class=pl-s1>img</span> <span class=pl-c1>in</span> <span class=pl-en>enumerate</span>(<span class=pl-s1>images</span>)], <span class=pl-s1>fps</span><span class=pl-c1>=</span><span class=pl-c1>15</span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L193\" class=\"blob-num js-line-number\" data-line-number=\"193\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC193\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-gym_chrome_dino_game-py-L194\" class=\"blob-num js-line-number\" data-line-number=\"194\"></td>\n        <td id=\"file-gym_chrome_dino_game-py-LC194\" class=\"blob-code blob-code-inner js-file-line\">    <span class=pl-en>exit</span>()</td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/luungoc2005/979c279effc9a2bd3de78ea57613a36f/raw/70eaa555b64da708f88c6c2177e15477b84a7057/gym_chrome_dino_game.py\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/luungoc2005/979c279effc9a2bd3de78ea57613a36f#file-gym_chrome_dino_game-py\">gym_chrome_dino_game.py</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<p>Further Reading:</p>\n<ul>\n<li>DQN paper: <a href=\"https://arxiv.org/abs/1312.5602\">https://arxiv.org/abs/1312.5602</a></li>\n<li><code class=\"language-text\">stable-baselines</code> documentation: <a href=\"https://stable-baselines.readthedocs.io/\">https://stable-baselines.readthedocs.io/</a></li>\n</ul>","frontmatter":{"title":"Tutorial: Build AI to play Google Chrome Dino game with Reinforcement Learning in 30 minutes","date":"2020-06-15T00:00:00.000Z"},"fields":{"readingTime":{"text":"9 min read"}}}},"pageContext":{"slug":"/blog/2020-06-15-chrome-dino-game-reinforcement-learning/"}}}